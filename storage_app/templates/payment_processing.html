{% extends 'base.html' %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-blue-400 via-purple-500 to-pink-600 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full">
        <div class="glass-card rounded-3xl p-8 text-center">
            <!-- Loading Animation -->
            <div class="w-20 h-20 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
            
            <h1 class="text-3xl font-bold text-gray-900 mb-4">Processing Payment</h1>
            <p class="text-gray-700 mb-6" id="status-message">
                Please wait while we confirm your payment...
            </p>
            
            <div class="bg-blue-50 rounded-2xl p-4 mb-6">
                <p class="text-blue-700 text-sm">
                    <i class="fas fa-info-circle mr-2"></i>
                    This usually takes just a few seconds
                </p>
            </div>
            
            <!-- Progress Bar -->
            <div class="w-full bg-gray-200 rounded-full h-2 mb-6">
                <div class="bg-blue-600 h-2 rounded-full animate-pulse" id="progress-bar"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const sessionId = "{{ session_id }}";
    let checkCount = 0;
    const maxChecks = 30; // 30 attempts (about 1.5 minutes)
    
    function checkPaymentStatus() {
        if (checkCount >= maxChecks) {
            document.getElementById('status-message').textContent = 'Payment taking longer than expected. Please check your email for confirmation.';
            return;
        }
        
        fetch(`/check-payment-status/?session_id=Rs.{sessionId}`)
            .then(response => response.json())
            .then(data => {
                checkCount++;
                
                if (data.status === 'success') {
                    // Payment successful - redirect to success page
                    window.location.href = "{% url 'payment_success' %}";
                } else if (data.status === 'processing') {
                    // Still processing - check again in 3 seconds
                    document.getElementById('status-message').textContent = data.message;
                    setTimeout(checkPaymentStatus, 3000);
                } else {
                    // Error
                    document.getElementById('status-message').textContent = 'Error: ' + data.message;
                }
            })
            .catch(error => {
                checkCount++;
                document.getElementById('status-message').textContent = 'Error checking payment status. Please refresh the page.';
                console.error('Error:', error);
            });
    }
    
    // Start checking payment status
    setTimeout(checkPaymentStatus, 3000);
</script>
{% endblock %}